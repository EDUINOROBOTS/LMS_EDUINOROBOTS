<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 8 LMS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="grade8">
    <button id="openIntro" class="intro-btn">INTRODUCTION</button>
    <script>
        const INTRO_URL = 'https://docs.google.com/presentation/d/1oY8NlJvAZHv6vll_11ewY-_p3b0sIw4BwhkkaSCyWd8/edit?usp=sharing';
        document.getElementById('openIntro')?.addEventListener('click', () => {
            window.open(INTRO_URL, '_blank', 'noopener');
        });
    </script>
    <div class="dashboard">
        <h1>ðŸŒ¾ GRADE 8 Learning Management System</h1>
        <div class="welcome">Welcome to Grade 8</div>
        <div class="curriculum">
            <div class="button-grid" id="buttonGrid">
                <!-- Buttons will be generated by JS -->
            </div>
        </div>
    </div>


    <script>
        const tasks = [
            "Environmental Monitoring Robot",
            "Voice Controlled Robot (MIT App)",
            "Dual Motor Controlled Arm",
            "LCD + Sensor Bot",
            "Servo-based Hand",
            "Object Avoid + Servo Direction",
            "Smart Home Controlled by Bot",
            "App Controlled Dustbin",
            "Sensor Car Parking Model",
            "Gesture Controlled Gripper (Remote)",
            "Autonomous Delivery Bot (Simple)",
            "IR Controlled Lift System",
            "Mini Humanoid Arms",
            "Light Following Robot",
            "Final Mini Robo Competition",
            "Intro to Arduino IoT Cloud",
            "Create Arduino Cloud Account"
        ];
        const emojis = [
            "ðŸŒ", "ðŸŽ¤", "ðŸ¤–", "ðŸ“±", "âœ‹", "ðŸš«", "ðŸ ", "ðŸ“±", "ðŸš—", "âœ‹", "ðŸ“¦", "â¬†ï¸", "ðŸ¤–", "ðŸ’¡", "ðŸ†", "â˜ï¸", "ðŸ“"
        ];

        // Per-topic links (edit these individually). Order must match `tasks`.
        const topicLinks = [
            INTRO_URL, // Environmental Monitoring Robot
            INTRO_URL, // Voice Controlled Robot (MIT App)
            INTRO_URL, // Dual Motor Controlled Arm
            INTRO_URL, // LCD + Sensor Bot
            INTRO_URL, // Servo-based Hand
            INTRO_URL, // Object Avoid + Servo Direction
            INTRO_URL, // Smart Home Controlled by Bot
            INTRO_URL, // App Controlled Dustbin
            INTRO_URL, // Sensor Car Parking Model
            INTRO_URL, // Gesture Controlled Gripper (Remote)
            INTRO_URL, // Autonomous Delivery Bot (Simple)
            INTRO_URL, // IR Controlled Lift System
            INTRO_URL, // Mini Humanoid Arms
            INTRO_URL, // Light Following Robot
            INTRO_URL, // Final Mini Robo Competition
            INTRO_URL, // Intro to Arduino IoT Cloud
            INTRO_URL  // Create Arduino Cloud Account
        ];

        function loadCompletions() {
            const completions = JSON.parse(localStorage.getItem('grade8_completions') || '{}');
            return completions;
        }

        function saveCompletions(completions) {
            localStorage.setItem('grade8_completions', JSON.stringify(completions));
        }

        let currentItem = null;
        let currentIndex = null;
        let currentCompletions = null;

        function showVerificationModal(item, index, completions) {
            currentItem = item;
            currentIndex = index;
            currentCompletions = completions;
            document.getElementById('verificationModal').style.display = 'block';
            document.getElementById('verificationCode').value = '';
            document.getElementById('verificationCode').focus();
        }

        function closeModal() {
            document.getElementById('verificationModal').style.display = 'none';
            currentItem = null;
            currentIndex = null;
            currentCompletions = null;
        }

        function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (code === '1234') {
                currentItem.classList.add('completed');
                currentCompletions[currentIndex] = true;
                saveCompletions(currentCompletions);
                closeModal();
            } else {
                alert('Incorrect code! Task not marked as completed.');
                document.getElementById('verificationCode').value = '';
                document.getElementById('verificationCode').focus();
            }
        }

        function generateButtons() {
            const grid = document.getElementById('buttonGrid');
            const completions = loadCompletions();
            grid.innerHTML = '';
            tasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                if (completions[index]) {
                    item.classList.add('completed');
                }

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completions[index] || false;
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        showVerificationModal(item, index, completions);
                        checkbox.checked = false; // hold until verified
                    } else {
                        item.classList.remove('completed');
                        delete completions[index];
                        saveCompletions(completions);
                    }
                });

                // clickable text (keeps same UI but opens per-topic link)
                const textSpan = document.createElement('span');
                textSpan.className = 'topic-text';
                textSpan.textContent = `${emojis[index] || ''} ${task}`;
                textSpan.style.cursor = 'pointer';
                textSpan.addEventListener('click', () => {
                    const url = topicLinks[index] || INTRO_URL;
                    window.open(url, '_blank', 'noopener');
                });

                item.appendChild(checkbox);
                item.appendChild(textSpan);
                grid.appendChild(item);
            });
        }
        generateButtons();

        // Load student name and update welcome message
        const studentData = JSON.parse(localStorage.getItem('loggedInStudent') || '{}');
        if (studentData.name) {
            document.querySelector('.welcome').textContent = `Welcome, ${studentData.name}!`;
        }

        // Modal event listeners - executed after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('verificationModal');
                if (event.target === modal) {
                    closeModal();
                }
            }

            // Handle Enter key in input
            document.getElementById('verificationCode').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    verifyCode();
                }
            });
        });
    </script>

    <!-- Verification Modal -->
    <div id="verificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                Teacher Verification Required
            </div>
            <div class="modal-body">
                <p>Enter the teacher verification code to mark this task as completed:</p>
                <input type="password" id="verificationCode" placeholder="Enter code..." maxlength="4">
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn btn-verify" onclick="verifyCode()">Verify</button>
            </div>
        </div>
    </div>

</body>
</html>