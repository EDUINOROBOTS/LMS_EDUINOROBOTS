<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 5 LMS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="grade5">
    <button id="openIntro" class="intro-btn">INTRODUCTION</button>
        <div class="dashboard">
            <h1>ðŸŒ³ GRADE 5 Learning Management System</h1>
            <div class="welcome">Welcome to Grade 5</div>
            <div class="curriculum">
                        <div class="button-grid" id="buttonGrid">
                    <!-- Buttons will be generated by JS -->
                </div>
            </div>
        </div>
    </div>


    <script>
        const tasks = [
            "Automatic Fan using DHT11",
            "Simple Flame Detection System",
            "Night Lamp using LDR",
            "Touchless Tap using IR + Servo",
            "Rain Detector",
            "Motion Sensor Intro (HC-SR501)",
            "Light-Based Alarm",
            "Object Counter with IR",
            "Simple Obstacle Detector",
            "Buzzer Alert System",
            "PWM Signal Basics",
            "Sensor Value Thresholding",
            "Relay Module Basics",
            "Power Supply with Breadboard Module",
            "Voltage Divider Concept",
            "Mini Test Project (IR + LCD + LED)",
            "Line Follower Concept"
        ];
        const emojis = [
            "ðŸ’¨", "ðŸ”¥", "ðŸŒ™", "ðŸš°", "ðŸŒ§ï¸", "ðŸ‘€", "ðŸš¨", "ðŸ”¢", "ðŸš§", "ðŸ”Š", "ðŸ“Š", "ðŸ“", "ðŸ”Œ", "âš¡", "ðŸ”‹", "ðŸ§ª", "ðŸ›¤ï¸"
        ];

        // Per-topic links (edit individually). Order must match `tasks`.
        const INTRO_URL = 'https://docs.google.com/presentation/d/1oY8NlJvAZHv6vll_11ewY-_p3b0sIw4BwhkkaSCyWd8/edit?usp=sharing';
        const topicLinks = [
            INTRO_URL, // Automatic Fan using DHT11
            INTRO_URL, // Simple Flame Detection System
            INTRO_URL, // Night Lamp using LDR
            INTRO_URL, // Touchless Tap using IR + Servo
            INTRO_URL, // Rain Detector
            INTRO_URL, // Motion Sensor Intro (HC-SR501)
            INTRO_URL, // Light-Based Alarm
            INTRO_URL, // Object Counter with IR
            INTRO_URL, // Simple Obstacle Detector
            INTRO_URL, // Buzzer Alert System
            INTRO_URL, // PWM Signal Basics
            INTRO_URL, // Sensor Value Thresholding
            INTRO_URL, // Relay Module Basics
            INTRO_URL, // Power Supply with Breadboard Module
            INTRO_URL, // Voltage Divider Concept
            INTRO_URL, // Mini Test Project (IR + LCD + LED)
            INTRO_URL  // Line Follower Concept
        ];

        function loadCompletions() {
            const completions = JSON.parse(localStorage.getItem('grade5_completions') || '{}');
            return completions;
        }

        function saveCompletions(completions) {
            localStorage.setItem('grade5_completions', JSON.stringify(completions));
        }

        let currentItem = null;
        let currentIndex = null;
        let currentCompletions = null;

        function showVerificationModal(item, index, completions) {
            currentItem = item;
            currentIndex = index;
            currentCompletions = completions;
            document.getElementById('verificationModal').style.display = 'block';
            document.getElementById('verificationCode').value = '';
            document.getElementById('verificationCode').focus();
        }

        function closeModal() {
            document.getElementById('verificationModal').style.display = 'none';
            currentItem = null;
            currentIndex = null;
            currentCompletions = null;
        }

        function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (code === '1234') {
                currentItem.classList.add('completed');
                currentCompletions[currentIndex] = true;
                saveCompletions(currentCompletions);
                closeModal();
            } else {
                alert('Incorrect code! Task not marked as completed.');
                document.getElementById('verificationCode').value = '';
                document.getElementById('verificationCode').focus();
            }
        }

        function generateButtons() {
            const grid = document.getElementById('buttonGrid');
            const completions = loadCompletions();
            grid.innerHTML = '';
            tasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                if (completions[index]) item.classList.add('completed');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completions[index] || false;
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        showVerificationModal(item, index, completions);
                        checkbox.checked = false; // hold until verified
                    } else {
                        item.classList.remove('completed');
                        delete completions[index];
                        saveCompletions(completions);
                    }
                });

                // Same UI: clickable text next to checkbox that opens per-topic link
                const textSpan = document.createElement('span');
                textSpan.className = 'topic-text';
                textSpan.textContent = `${emojis[index] || ''} ${task}`;
                textSpan.style.cursor = 'pointer';
                textSpan.addEventListener('click', () => {
                    const url = topicLinks[index] || INTRO_URL;
                    window.open(url, '_blank', 'noopener');
                });

                item.appendChild(checkbox);
                item.appendChild(textSpan);
                grid.appendChild(item);
            });
        }
        generateButtons();

        // Load student name and update welcome message
        const studentData = JSON.parse(localStorage.getItem('loggedInStudent') || '{}');
        if (studentData.name) {
            document.querySelector('.welcome').textContent = `Welcome, ${studentData.name}!`;
        }

        // Modal event listeners - executed after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('verificationModal');
                if (event.target === modal) {
                    closeModal();
                }
            }

            // Handle Enter key in input
            document.getElementById('verificationCode').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    verifyCode();
                }
            });
        });

        document.getElementById('openIntro')?.addEventListener('click', () => {
            window.open(INTRO_URL, '_blank', 'noopener');
        });
    </script>

    <!-- Verification Modal -->
    <div id="verificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                Teacher Verification Required
            </div>
            <div class="modal-body">
                <p>Enter the teacher verification code to mark this task as completed:</p>
                <input type="password" id="verificationCode" placeholder="Enter code..." maxlength="4">
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn btn-verify" onclick="verifyCode()">Verify</button>
            </div>
        </div>
    </div>

</body>
</html>