<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ‚Äî Students ‚Äî LMS</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      --warning-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
      --shadow: 0 20px 50px rgba(0,0,0,0.1);
      --border-radius: 20px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 40%, rgba(255,255,255,0.05) 0%, transparent 50%);
      pointer-events: none;
    }

    .center {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
    }

    .login-card {
      width: 100%;
      max-width: 420px;
      padding: 100px;
      border-radius: var(--border-radius);
      background: var(--card-bg);
      box-shadow: var(--shadow);
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-card h2 {
      margin: 0 0 30px;
      font-size: 28px;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .login-card input {
      width: 100%;
      padding: 16px 20px;
      margin: 12px 0;
      border-radius: 12px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      font-size: 16px;
      font-family: inherit;
      transition: var(--transition);
      background: rgba(255,255,255,0.8);
    }

    .login-card input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    .login-card input::placeholder {
      color: #999;
    }

    .login-btn {
      background: var(--primary-gradient);
      color: white;
      padding: 16px 32px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      width: 100%;
      margin-top: 20px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .login-btn:active {
      transform: translateY(0);
    }

    .login-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .login-btn:hover::before {
      left: 100%;
    }

    .admin-wrap {
      max-width: 1400px;
      margin: 40px auto;
      padding: 40px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .admin-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .admin-header h2 {
      margin: 0;
      font-size: 32px;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logout-btn {
      background: var(--danger-gradient);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }

    .controls {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      background: rgba(102, 126, 234, 0.05);
      padding: 24px;
      border-radius: 16px;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .controls input, .controls select {
      padding: 14px 18px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      transition: var(--transition);
      background: white;
      min-width: 200px;
    }

    .controls input:focus, .controls select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .controls select {
      cursor: pointer;
    }

    .action-btn {
      background: var(--success-gradient);
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
    }

    .action-btn:nth-child(2) {
      background: var(--secondary-gradient);
    }

    .action-btn:nth-child(2):hover {
      box-shadow: 0 8px 20px rgba(245, 87, 108, 0.3);
    }

    .action-btn:nth-child(3) {
      background: var(--warning-gradient);
      color: #333;
    }

    .action-btn:nth-child(3):hover {
      box-shadow: 0 8px 20px rgba(252, 182, 159, 0.3);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      background: white;
    }

    th {
      padding: 20px 16px;
      background: var(--primary-gradient);
      color: white;
      text-align: left;
      font-weight: 600;
      font-size: 16px;
      border: none;
    }

    td {
      padding: 18px 16px;
      border-bottom: 1px solid rgba(102, 126, 234, 0.1);
      transition: var(--transition);
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
      transform: scale(1.01);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .muted {
      color: #666;
      font-size: 16px;
      font-style: italic;
      text-align: center;
      padding: 40px;
    }

    .stats-card {
      background: linear-gradient(135deg, #48cae4, #023e8a);
      color: white;
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .stats-card .icon {
      font-size: 32px;
      opacity: 0.8;
    }

    .stats-card .content h3 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 700;
    }

    .stats-card .content p {
      margin: 0;
      opacity: 0.9;
      font-size: 14px;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 10px;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .admin-wrap {
        margin: 20px;
        padding: 20px;
      }

      .admin-header {
        flex-direction: column;
        text-align: center;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .controls input, .controls select {
        min-width: auto;
      }

      .action-btn {
        justify-content: center;
      }

      table {
        font-size: 14px;
      }

      th, td {
        padding: 12px 8px;
      }

      .login-card {
        padding: 30px 20px;
      }
    }

    @media (max-width: 480px) {
      .admin-header h2 {
        font-size: 24px;
      }

      .controls {
        padding: 16px;
      }

      .stats-card {
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>

<body>

<body>

<!-- LOGIN -->
<div id="loginView" class="center">
  <div class="login-card">
    <h2>üîê Admin Login</h2>
    <input id="adminUser" placeholder="üë§ Username" type="text">
    <input id="adminPass" type="password" placeholder="üîí Password">
    <button id="loginBtn" class="login-btn">üöÄ Login</button>
    <div id="loginError" class="error-message" style="display:none"></div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="admin-wrap" style="display:none">
  <div class="admin-header">
    <h2>üìä Admin Dashboard</h2>
    <button id="logoutBtn" class="logout-btn">üö™ Logout</button>
  </div>

  <div class="stats-card">
    <div class="icon">üë•</div>
    <div class="content">
      <h3 id="totalStudents">270</h3>
      <p>Total Students</p>
    </div>
  </div>

  <div class="controls">
    <input id="q" type="search" placeholder="üîç Search by name or ID">
    <select id="gradeFilter">
      <option value="">üìö All grades</option>
      <option value="3">Grade 3</option>
      <option value="4">Grade 4</option>
      <option value="5">Grade 5</option>
      <option value="6">Grade 6</option>
      <option value="7">Grade 7</option>
      <option value="8">Grade 8</option>
      <option value="9">Grade 9</option>
    </select>
    <button id="copyIds" class="action-btn">üìã Copy IDs</button>
    <button id="copyNames" class="action-btn">üìù Copy Names</button>
    <button id="downloadCsv" class="action-btn">üì• Download CSV</button>
  </div>

  <table id="studentsTable">
    <thead>
      <tr><th>üìö Grade</th><th>üÜî ID</th><th>üë§ Name</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
/* ========== LOGIN ========== */
const loginView = document.getElementById('loginView');
const adminPanel = document.getElementById('adminPanel');
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');
const adminUser = document.getElementById('adminUser');
const adminPass = document.getElementById('adminPass');
const logoutBtn = document.getElementById('logoutBtn');

function showPanel() {
  loginView.style.display = 'none';
  adminPanel.style.display = 'block';
  sessionStorage.setItem('admin', '1');
}
function showLogin() {
  loginView.style.display = 'flex';
  adminPanel.style.display = 'none';
  sessionStorage.removeItem('admin');
}

loginBtn.onclick = () => {
  if ((adminUser.value || '').trim() === 'admin' && (adminPass.value || '').trim() === '1234') {
    loginError.style.display = 'none';
    adminUser.value = adminPass.value = '';
    showPanel();
    initDirectory();
  } else {
    loginError.textContent = '‚ùå Invalid credentials';
    loginError.style.display = 'block';
  }
};

logoutBtn.onclick = () => {
  showLogin();
  location.reload();
};

if (sessionStorage.getItem('admin')) {
  showPanel();
}

/* ========== STUDENTS DATA (full lists loaded) ========== */
/* grade3..grade9 arrays copied from project */
const grade3Students = [
  { id: "F", name: "Aarav Sharma" },
  { id: "123002", name: "Priya Patel" },
  { id: "123003", name: "Rohan Kumar" },
  { id: "123004", name: "Ananya Singh" },
  { id: "123005", name: "Vikram Gupta" },
  { id: "123006", name: "Meera Joshi" },
  { id: "123007", name: "Arjun Reddy" },
  { id: "123008", name: "Kavya Iyer" },
  { id: "123009", name: "Aditya Nair" },
  { id: "123010", name: "Sneha Kapoor" },
  { id: "123011", name: "Rahul Verma" },
  { id: "123012", name: "Pooja Sharma" },
  { id: "123013", name: "Karan Singh" },
  { id: "123014", name: "Divya Patel" },
  { id: "123015", name: "Amit Kumar" },
  { id: "123016", name: "Neha Gupta" },
  { id: "123017", name: "Sanjay Joshi" },
  { id: "123018", name: "Kriti Reddy" },
  { id: "123019", name: "Ravi Iyer" },
  { id: "123020", name: "Anjali Nair" },
  { id: "123021", name: "Vivek Kapoor" },
  { id: "123022", name: "Shreya Verma" },
  { id: "123023", name: "Rajesh Singh" },
  { id: "123024", name: "Priyanka Sharma" },
  { id: "123025", name: "Deepak Patel" },
  { id: "123026", name: "Kiran Kumar" },
  { id: "123027", name: "Sunita Gupta" },
  { id: "123028", name: "Manoj Joshi" },
  { id: "123029", name: "Rekha Reddy" },
  { id: "123030", name: "Suresh Iyer" }
];

const grade4Students = [
  { id: "124001", name: "Arun Nair" },
  { id: "124002", name: "Kavita Kapoor" },
  { id: "124003", name: "Suresh Verma" },
  { id: "124004", name: "Lakshmi Singh" },
  { id: "124005", name: "Rajendra Sharma" },
  { id: "124006", name: "Sunita Patel" },
  { id: "124007", name: "Mohan Kumar" },
  { id: "124008", name: "Geeta Gupta" },
  { id: "124009", name: "Ramesh Joshi" },
  { id: "124010", name: "Kamala Reddy" },
  { id: "124011", name: "Venkatesh Iyer" },
  { id: "124012", name: "Indira Nair" },
  { id: "124013", name: "Prakash Kapoor" },
  { id: "124014", name: "Sarita Verma" },
  { id: "124015", name: "Ganesh Singh" },
  { id: "124016", name: "Radha Sharma" },
  { id: "124017", name: "Krishna Patel" },
  { id: "124018", name: "Lalita Kumar" },
  { id: "124019", name: "Shankar Gupta" },
  { id: "124020", name: "Parvati Joshi" },
  { id: "124021", name: "Rangan Reddy" },
  { id: "124022", name: "Meenakshi Iyer" },
  { id: "124023", name: "Narasimha Nair" },
  { id: "124024", name: "Padma Kapoor" },
  { id: "124025", name: "Vasudeva Verma" },
  { id: "124026", name: "Saraswati Singh" },
  { id: "124027", name: "Brahma Sharma" },
  { id: "124028", name: "Vishnu Patel" },
  { id: "124029", name: "Lakshmi Kumar" },
  { id: "124030", name: "Shiva Gupta" }
];

const grade5Students = [
  { id: "125001", name: "Ravi Shankar" },
  { id: "125002", name: "Maya Krishnan" },
  { id: "125003", name: "Arun Subramanian" },
  { id: "125004", name: "Latha Venkatesan" },
  { id: "125005", name: "Srinivasan Iyer" },
  { id: "125006", name: "Kamaladevi Nair" },
  { id: "125007", name: "Rajagopal Kapoor" },
  { id: "125008", name: "Vijayalakshmi Verma" },
  { id: "125009", name: "Chandrashekhar Singh" },
  { id: "125010", name: "Anandita Sharma" },
  { id: "125011", name: "Balakrishnan Patel" },
  { id: "125012", name: "Chitra Kumar" },
  { id: "125013", name: "Dinesh Gupta" },
  { id: "125014", name: "Eswari Joshi" },
  { id: "125015", name: "Feroz Reddy" },
  { id: "125016", name: "Gayathri Iyer" },
  { id: "125017", name: "Harish Nair" },
  { id: "125018", name: "Indumathi Kapoor" },
  { id: "125019", name: "Jayaprakash Verma" },
  { id: "125020", name: "Kamakshi Singh" },
  { id: "125021", name: "Lakshminarayanan Sharma" },
  { id: "125022", name: "Madhavi Patel" },
  { id: "125023", name: "Nandakumar Kumar" },
  { id: "125024", name: "Padmavati Gupta" },
  { id: "125025", name: "Qamar Joshi" },
  { id: "125026", name: "Radhakrishnan Reddy" },
  { id: "125027", name: "Sarojini Iyer" },
  { id: "125028", name: "Thirunavukkarasu Nair" },
  { id: "125029", name: "Usha Kapoor" },
  { id: "125030", name: "Venkataramanan Verma" }
];

const grade6Students = [
  { id: "126001", name: "Yogeshwaran Singh" },
  { id: "126002", name: "Zeenat Sharma" },
  { id: "126003", name: "Abdul Rahman Patel" },
  { id: "126004", name: "Bhagya Lakshmi Kumar" },
  { id: "126005", name: "Chandramouli Gupta" },
  { id: "126006", name: "Devaki Joshi" },
  { id: "126007", name: "Ezhilarasan Reddy" },
  { id: "126008", name: "Fathima Iyer" },
  { id: "126009", name: "Ganapathi Nair" },
  { id: "126010", name: "Hemalatha Kapoor" },
  { id: "126011", name: "Ilangovan Verma" },
  { id: "126012", name: "Jayanthi Singh" },
  { id: "126013", name: "Karthikeyan Sharma" },
  { id: "126014", name: "Lalitha Patel" },
  { id: "126015", name: "Mohanraj Kumar" },
  { id: "126016", name: "Nandhini Gupta" },
  { id: "126017", name: "Oomai Kizhangu Joshi" },
  { id: "126018", name: "Ponnusamy Reddy" },
  { id: "126019", name: "Quadir Iyer" },
  { id: "126020", name: "Rajalakshmi Nair" },
  { id: "126021", name: "Sathyanarayanan Kapoor" },
  { id: "126022", name: "Thangam Verma" },
  { id: "126023", name: "Udhayakumar Singh" },
  { id: "126024", name: "Valli Sharma" },
  { id: "126025", name: "Waseem Patel" },
  { id: "126026", name: "Xavier Kumar" },
  { id: "126027", name: "Yamini Gupta" },
  { id: "126028", name: "Zaheer Joshi" },
  { id: "126029", name: "Ambika Reddy" },
  { id: "126030", name: "Balamurugan Iyer" }
];

const grade7Students = [
  { id: "127001", name: "Chandrika Nair" },
  { id: "127002", name: "Dhananjayan Kapoor" },
  { id: "127003", name: "Eswaran Verma" },
  { id: "127004", name: "Fathima Beevi Singh" },
  { id: "127005", name: "Ganesan Sharma" },
  { id: "127006", name: "Hema Rani Patel" },
  { id: "127007", name: "Indrajith Kumar" },
  { id: "127008", name: "Jayachandran Gupta" },
  { id: "127009", name: "Kalaivani Joshi" },
  { id: "127010", name: "Lokanathan Reddy" },
  { id: "127011", name: "Mahalakshmi Iyer" },
  { id: "127012", name: "Natarajan Nair" },
  { id: "127013", name: "Oviya Kapoor" },
  { id: "127014", name: "Prabhu Verma" },
  { id: "127015", name: "Qutubuddin Singh" },
  { id: "127016", name: "Ramanathan Sharma" },
  { id: "127017", name: "Sasikala Patel" },
  { id: "127018", name: "Thirupathi Kumar" },
  { id: "127019", name: "Umayal Gupta" },
  { id: "127020", name: "Venkateswara Joshi" },
  { id: "127021", name: "Waqar Ahmed Reddy" },
  { id: "127022", name: "Xavier Joseph Iyer" },
  { id: "127023", name: "Yamuna Nair" },
  { id: "127024", name: "Zaheer Hussain Kapoor" },
  { id: "127025", name: "Aishwarya Verma" },
  { id: "127026", name: "Bharath Singh" },
  { id: "127027", name: "Charumathi Sharma" },
  { id: "127028", name: "Dharani Patel" },
  { id: "127029", name: "Eshwar Kumar" },
  { id: "127030", name: "Fathima Zohra Gupta" }
];

const grade8Students = [
  { id: "128001", name: "Gautami Joshi" },
  { id: "128002", name: "Hariprasad Reddy" },
  { id: "128003", name: "Indumathi Iyer" },
  { id: "128004", name: "Jayapriya Nair" },
  { id: "128005", name: "Kamalakannan Kapoor" },
  { id: "128006", name: "Lalitha Kumari Verma" },
  { id: "128007", name: "Mohanavel Singh" },
  { id: "128008", name: "Nandhini Priya Sharma" },
  { id: "128009", name: "Omsakthi Patel" },
  { id: "128010", name: "Prabakaran Kumar" },
  { id: "128011", name: "Quaid E Milleth Gupta" },
  { id: "128012", name: "Rajarajeswari Joshi" },
  { id: "128013", name: "Sathish Kumar Reddy" },
  { id: "128014", name: "Thangapandian Iyer" },
  { id: "128015", name: "Usharani Nair" },
  { id: "128016", name: "Venkatraman Kapoor" },
  { id: "128017", name: "Waseem Akram Verma" },
  { id: "128018", name: "Xavier Benedict Singh" },
  { id: "128019", name: "Yamuna Karthikeyan Sharma" },
  { id: "128020", name: "Zaheer Abbas Patel" },
  { id: "128021", name: "Abirami Kumar" },
  { id: "128022", name: "Balasubramanian Gupta" },
  { id: "128023", name: "Chandramukhi Joshi" },
  { id: "128024", name: "Dhanasekar Reddy" },
  { id: "128025", name: "Eswari Iyer" },
  { id: "128026", name: "Fathima Rifaya Nair" },
  { id: "128027", name: "Ganesh Kumar Kapoor" },
  { id: "128028", name: "Hemalatha Verma" },
  { id: "128029", name: "Ilangovan Singh" },
  { id: "128256", name: "BASHA" },
  { id: "128030", name: "Jayanthi Sharma" }
];

const grade9Students = [
  { id: "129001", name: "Karthikeyan Patel" },
  { id: "129002", name: "Lalitha Priya Kumar" },
  { id: "129003", name: "Mohanraj Gupta" },
  { id: "129004", name: "Nandhini Joshi" },
  { id: "129005", name: "Oomai Selvi Reddy" },
  { id: "129006", name: "Ponnusamy Iyer" },
  { id: "129007", name: "Quadir Hussain Nair" },
  { id: "129008", name: "Rajalakshmi Kapoor" },
  { id: "129009", name: "Sathyanarayanan Verma" },
  { id: "129010", name: "Thangam Singh" },
  { id: "129011", name: "Udhayakumar Sharma" },
  { id: "129012", name: "Valli Patel" },
  { id: "129013", name: "Waseem Kumar" },
  { id: "129014", name: "Xavier Joseph Gupta" },
  { id: "129015", name: "Yamini Joshi" },
  { id: "129016", name: "Zaheer Reddy" },
  { id: "129017", name: "Ambika Iyer" },
  { id: "129018", name: "Balamurugan Nair" },
  { id: "129019", name: "Chandrika Kapoor" },
  { id: "129020", name: "Dhananjayan Verma" },
  { id: "129021", name: "Eswaran Singh" },
  { id: "129022", name: "Fathima Beevi Sharma" },
  { id: "129023", name: "Ganesan Patel" },
  { id: "129024", name: "Hema Rani Kumar" },
  { id: "129025", name: "Indrajith Gupta" },
  { id: "129026", name: "Jayachandran Joshi" },
  { id: "129027", name: "Kalaivani Reddy" },
  { id: "129028", name: "Lokanathan Iyer" },
  { id: "129029", name: "Mahalakshmi Nair" },
  { id: "129030", name: "Natarajan Kapoor" }
];

/* flattened array with grade property */
const studentsObj = {3: grade3Students, 4: grade4Students, 5: grade5Students, 6: grade6Students, 7: grade7Students, 8: grade8Students, 9: grade9Students};
const all = Object.entries(studentsObj).flatMap(([grade, arr]) => (arr || []).map(s => ({ grade: Number(grade), id: String(s.id), name: s.name })));

/* ========== RENDER & FILTER ========== */
const tbody = document.querySelector('#studentsTable tbody');
const q = document.getElementById('q');
const gradeFilter = document.getElementById('gradeFilter');

function render(list) {
  tbody.innerHTML = '';
  if (!list.length) {
    tbody.innerHTML = '<tr><td colspan="3" class="muted">No students found.</td></tr>';
    return;
  }
  list.forEach(s => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.grade}</td><td>${s.id}</td><td>${s.name}</td>`;
    tr.title = 'Click to copy Student ID';
    tr.style.cursor = 'pointer';
    tr.addEventListener('click', () => navigator.clipboard?.writeText(s.id).then(()=>alert('‚úÖ Copied ID: '+s.id)).catch(()=>{}));
    tbody.appendChild(tr);
  });
}

function applyFilters() {
  const term = (q.value || '').trim().toLowerCase();
  const gradeVal = gradeFilter.value;
  let list = all.slice();
  if (gradeVal) list = list.filter(i => String(i.grade) === gradeVal);
  if (term) list = list.filter(i => i.id.toLowerCase().includes(term) || i.name.toLowerCase().includes(term));
  render(list);

  // Update stats
  document.getElementById('totalStudents').textContent = list.length;
}

/* copy / csv helpers */
document.getElementById('copyIds').addEventListener('click', () => {
  const visible = Array.from(tbody.querySelectorAll('tr')).map(r => r.children[1]?.textContent).filter(Boolean);
  if (!visible.length) return alert('‚ö†Ô∏è No IDs to copy.');
  navigator.clipboard?.writeText(visible.join('\n')).then(()=>alert('‚úÖ Copied '+visible.length+' IDs.'));
});
document.getElementById('copyNames').addEventListener('click', () => {
  const visible = Array.from(tbody.querySelectorAll('tr')).map(r => r.children[2]?.textContent).filter(Boolean);
  if (!visible.length) return alert('‚ö†Ô∏è No names to copy.');
  navigator.clipboard?.writeText(visible.join('\n')).then(()=>alert('‚úÖ Copied '+visible.length+' names.'));
});
document.getElementById('downloadCsv').addEventListener('click', () => {
  const visibleRows = Array.from(tbody.querySelectorAll('tr')).map(r => {
    const c = r.children; if (!c[0]) return null;
    return [c[0].textContent, c[1].textContent, c[2].textContent].map(v => '"' + String(v).replace(/"/g,'""') + '"').join(',');
  }).filter(Boolean);
  if (!visibleRows.length) return alert('‚ö†Ô∏è No data to download.');
  const csv = ['Grade,ID,Name', ...visibleRows].join('\r\n');
  const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'students.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  alert('‚úÖ CSV downloaded successfully!');
});

/* wire filters */
q.addEventListener('input', applyFilters);
gradeFilter.addEventListener('change', applyFilters);

function initDirectory() {
  applyFilters();
}

/* auto-init if already logged in */
if (sessionStorage.getItem('admin')) {
  initDirectory();
}
</script>

</body>
</html>
