<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 9 LMS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="grade9">
    <button id="openIntro" class="intro-btn">INTRODUCTION</button>
    <script>
        const INTRO_URL = 'https://docs.google.com/presentation/d/1oY8NlJvAZHv6vll_11ewY-_p3b0sIw4BwhkkaSCyWd8/edit?usp=sharing';
        const INTRO1_URL = 'https://docs.google.com/presentation/d/1whCZ5nHN0uWpPDPD7DfRAfYLaVF8kWkcQBFrC-bA9TY/edit?usp=sharing';
        document.getElementById('openIntro')?.addEventListener('click', () => {
            window.open(INTRO_URL, '_blank', 'noopener');
        });
    </script>
    <div class="dashboard">
        <h1>ðŸŒº GRADE 9 Learning Management System</h1>
        <div class="welcome">Welcome to Grade 9</div>
        <div class="curriculum">
            <div class="button-grid" id="buttonGrid">
                <!-- Buttons will be generated by JS -->
            </div>
        </div>
    </div>


    <script>
        const tasks = [
            "Connect NodeMCU to Cloud",
            "Cloud-based LED Blink",
            "DHT11 Cloud Temp Display",
            "Control LED via Dashboard",
            "Humidity Monitoring",
            "Buzzer Control from Web",
            "Graph of Temperature",
            "Mobile App for Control",
            "Soil Moisture Cloud",
            "Cloud-Controlled Servo",
            "Cloud Fan ON/OFF",
            "LDR Intensity Cloud Display",
            "High Temp Alert",
            "Ultrasonic Distance to Cloud",
            "RGB LED Cloud Control",
            "Remote Button Read",
            "Cloud-Based Door Lock"
        ];
        const emojis = [
            "â˜ï¸", "ðŸ’¡", "ðŸŒ¡ï¸", "ðŸ“Š", "ðŸ’§", "ðŸ”Š", "ðŸ“ˆ", "ðŸ“±", "ðŸŒ±", "âš™ï¸", "ðŸ’¨", "ðŸŒž", "ðŸš¨", "ðŸ“", "ðŸŽ¨", "ðŸ”˜", "ðŸ”’"
        ];

        // Per-topic links (edit these individually). Keep order aligned with `tasks`.
        const topicLinks = [
            INTRO_URL, // Connect NodeMCU to Cloud
            INTRO1_URL, // Cloud-based LED Blink
            INTRO_URL, // DHT11 Cloud Temp Display
            INTRO_URL, // Control LED via Dashboard
            INTRO_URL, // Humidity Monitoring
            INTRO_URL, // Buzzer Control from Web
            INTRO_URL, // Graph of Temperature
            INTRO_URL, // Mobile App for Control
            INTRO_URL, // Soil Moisture Cloud
            INTRO_URL, // Cloud-Controlled Servo
            INTRO_URL, // Cloud Fan ON/OFF
            INTRO_URL, // LDR Intensity Cloud Display
            INTRO_URL, // High Temp Alert
            INTRO_URL, // Ultrasonic Distance to Cloud
            INTRO_URL, // RGB LED Cloud Control
            INTRO_URL, // Remote Button Read
            INTRO_URL  // Cloud-Based Door Lock
        ];

        function loadCompletions() {
            const completions = JSON.parse(localStorage.getItem('grade9_completions') || '{}');
            return completions;
        }

        function saveCompletions(completions) {
            localStorage.setItem('grade9_completions', JSON.stringify(completions));
        }

        let currentItem = null;
        let currentIndex = null;
        let currentCompletions = null;

        function showVerificationModal(item, index, completions) {
            currentItem = item;
            currentIndex = index;
            currentCompletions = completions;
            document.getElementById('verificationModal').style.display = 'block';
            document.getElementById('verificationCode').value = '';
            document.getElementById('verificationCode').focus();
        }

        function closeModal() {
            document.getElementById('verificationModal').style.display = 'none';
            currentItem = null;
            currentIndex = null;
            currentCompletions = null;
        }

        function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (code === '1234') {
                currentItem.classList.add('completed');
                currentCompletions[currentIndex] = true;
                saveCompletions(currentCompletions);
                closeModal();
            } else {
                alert('Incorrect code! Task not marked as completed.');
                document.getElementById('verificationCode').value = '';
                document.getElementById('verificationCode').focus();
            }
        }

        function generateButtons() {
            const grid = document.getElementById('buttonGrid');
            const completions = loadCompletions();
            grid.innerHTML = '';
            tasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                if (completions[index]) {
                    item.classList.add('completed');
                }
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completions[index] || false;
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        showVerificationModal(item, index, completions);
                        checkbox.checked = false; // Temporarily uncheck until verified
                    } else {
                        item.classList.remove('completed');
                        delete completions[index];
                        saveCompletions(completions);
                    }
                });

                // Keep same UI but make the topic text clickable to open its link
                const textSpan = document.createElement('span');
                textSpan.className = 'topic-text';
                textSpan.textContent = `${emojis[index] || ''} ${task}`;
                textSpan.style.cursor = 'pointer';
                textSpan.addEventListener('click', () => {
                    const url = topicLinks[index] || INTRO_URL;
                    window.open(url, '_blank', 'noopener');
                });

                item.appendChild(checkbox);
                item.appendChild(textSpan);
                grid.appendChild(item);
            });
        }
        generateButtons();

        // Load student name and update welcome message
        const studentData = JSON.parse(localStorage.getItem('loggedInStudent') || '{}');
        if (studentData.name) {
            document.querySelector('.welcome').textContent = `Welcome, ${studentData.name}!`;
        }

        // Modal event listeners - executed after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('verificationModal');
                if (event.target === modal) {
                    closeModal();
                }
            }

            // Handle Enter key in input
            document.getElementById('verificationCode').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    verifyCode();
                }
            });
        });
    </script>

    <!-- Verification Modal -->
    <div id="verificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                Teacher Verification Required
            </div>
            <div class="modal-body">
                <p>Enter the teacher verification code to mark this task as completed:</p>
                <input type="password" id="verificationCode" placeholder="Enter code..." maxlength="4">
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn btn-verify" onclick="verifyCode()">Verify</button>
            </div>
        </div>
    </div>

</body>
</html>